{% extends "core/base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'accounts:dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item active">Application #{{ application.id }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>Application Details</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Application ID:</strong> {{ application.id }}</p>
                        <p><strong>Applicant:</strong> {{ application.applicant.username }}</p>
                        <p><strong>Loan Type:</strong> {{ application.loan_type.name }}</p>
                        <p><strong>Amount:</strong> NPR {{ application.amount|floatformat:0 }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Duration:</strong> {{ application.duration_months }} months</p>
                        <p><strong>Monthly Income:</strong> NPR {{ application.monthly_income|floatformat:0 }}</p>
                        <p><strong>Status:</strong> 
                            <span class="badge status-{{ application.status }}">{{ application.get_status_display }}</span>
                        </p>
                        {% if application.officer %}
                        <p><strong>Assigned Officer:</strong> {{ application.officer.username }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="mt-3">
                    <p><strong>Purpose:</strong></p>
                    <p>{{ application.purpose }}</p>
                </div>
                <div class="mt-3">
                    <p><strong>Address:</strong></p>
                    <p>{{ application.address }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Actions</h5>
            </div>
            <div class="card-body">
                {% if user == application.applicant and application.status in 'submitted,info_requested' %}
                <a href="{% url 'loans:upload_documents' application.id %}" class="btn btn-primary mb-2">Upload Documents</a>
                {% endif %}
                
                {% if user == application.officer and application.status == 'under_review' %}
                <a href="{% url 'loans:review_application' application.id %}" class="btn btn-warning mb-2">Review Application</a>
                {% endif %}
                
                <a href="{% url 'accounts:dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
            </div>
        </div>
        
        {% if documents %}
        <div class="card mt-3">
            <div class="card-header">
                <h5>Documents ({{ documents|length }})</h5>
            </div>
            <div class="card-body">
                <ul class="list-group">
                    {% for document in documents %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ document.get_document_type_display }}
                        <span class="badge status-{{ document.verification_status }}">{{ document.get_verification_status_display }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
